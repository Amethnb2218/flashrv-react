// ============================================
// SALON SETTINGS MODEL
// ============================================
model SalonSettings {
  id        String   @id @default(uuid())
  salonId   String   @unique
  salon     Salon    @relation(fields: [salonId], references: [id], onDelete: Cascade)
  preferences String? // JSON string (horaires, notifications, etc.)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("salon_settings")
}

// ============================================
// USER SETTINGS MODEL
// ============================================
model UserSettings {
  id        String   @id @default(uuid())
  userId    String   @unique
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  preferences String? // JSON string (langue, notifications, etc.)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("user_settings")
}
// ============================================
// NOTIFICATION MODEL
// ============================================
model Notification {
  id        String   @id @default(uuid())
  message   String
  type      String   // info, warning, error, booking, payment, etc.
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("notifications")
}
// ============================================
// SALON PAYMENT METHOD MODEL
// ============================================
model SalonPaymentMethod {
  id        String   @id @default(uuid())
  salonId   String
  salon     Salon    @relation(fields: [salonId], references: [id], onDelete: Cascade)
  method    String   // WAVE, ORANGE_MONEY, FREE_MONEY, CASH, CARD
  enabled   Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([salonId, method])
  @@map("salon_payment_methods")
}
// ============================================
// PLANNING BREAK MODEL
// ============================================
model PlanningBreak {
  id        String   @id @default(uuid())
  start     DateTime
  end       DateTime
  label     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  salonId   String?
  salon     Salon?   @relation(fields: [salonId], references: [id], onDelete: Cascade)

  @@map("planning_breaks")
}

// ============================================
// PLANNING EXCEPTION MODEL
// ============================================
model PlanningException {
  id        String   @id @default(uuid())
  date      DateTime
  reason    String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  salonId   String?
  salon     Salon?   @relation(fields: [salonId], references: [id], onDelete: Cascade)

  @@map("planning_exceptions")
}

// ============================================
// PLANNING HOLIDAY MODEL
// ============================================
model PlanningHoliday {
  id        String   @id @default(uuid())
  date      DateTime
  label     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  salonId   String?
  salon     Salon?   @relation(fields: [salonId], references: [id], onDelete: Cascade)

  @@map("planning_holidays")
}
// ============================================
// STAFF MEMBER MODEL
// ============================================
model StaffMember {
  id        String   @id @default(uuid())
  name      String
  role      String
  email     String?
  phone     String?
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  salonId   String?
  salon     Salon?   @relation(fields: [salonId], references: [id], onDelete: Cascade)

  @@map("staff_members")
}
// ============================================
// PROMO CODE MODEL
// ============================================
model PromoCode {
  id          String   @id @default(uuid())
  code        String
  description String?
  discount    Float    // Pourcentage ou montant fixe
  type        String   // "percent" ou "fixed"
  isActive    Boolean  @default(true)
  validFrom   DateTime?
  validTo     DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  salonId     String?
  salon       Salon?   @relation(fields: [salonId], references: [id], onDelete: Cascade)

  @@unique([salonId, code])
  @@map("promo_codes")
}
// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

// ============================================
// USER MODEL
// ============================================
model User {
  id          String   @id @default(uuid())
  email       String   @unique
  username    String?  @unique
  phoneNumber String?
  address     String?
  noShowCount Int      @default(0)
  preferences String?
  notes       String?
  password    String   // Mot de passe hashé, obligatoire
  googleSub   String?  @unique // Google OAuth subject ID (optionnel)
  name        String?
  picture     String?
  
  // Role & Status management
  role        String   @default("CLIENT") // CLIENT, PRO, ADMIN, SUPER_ADMIN
  status      String   @default("APPROVED") // PENDING, APPROVED, REJECTED, SUSPENDED
  // Note: CLIENT = APPROVED par défaut, PRO = PENDING par défaut à l'inscription

  // Restriction flags (for PRO/ADMIN management)
  canCreateService Boolean @default(true) // PRO: can create services
  canBook          Boolean @default(true) // PRO: can accept bookings
  isPublic         Boolean @default(true) // PRO: visible in public listings
  adminType        String? // ADMIN: type (VALIDATION, SUPPORT, etc)
  isRestricted     Boolean @default(false) // ADMIN: restricted rights
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  appointments    Appointment[]  @relation("ClientAppointments")
  salon           Salon?         @relation("SalonOwner")
  coiffeurProfile Coiffeur?
  reviews         Review[]
  payments        Payment[]
  loyalty         Loyalty[]
  notifications   Notification[]
  chatMessages    ChatMessage[]
  feedbacks       Feedback[]
  userSettings    UserSettings?

  @@map("users")
}

// Role values: CLIENT, PRO, ADMIN, SUPER_ADMIN
// Status values: PENDING, APPROVED, REJECTED, SUSPENDED

// ============================================
// SALON MODEL
// ============================================
model Salon {
  id          String   @id @default(uuid())
  name        String
  description String?
  address     String
  city        String
  phone       String?
  email       String?
  image       String?
  rating      Float    @default(0)
  reviewCount Int      @default(0)
  salonType   String   @default("mixte") // homme, femme, mixte
  isOpen      Boolean  @default(true)
  status      String   @default("PENDING") // PENDING, APPROVED, REJECTED
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Owner relation
  ownerId String? @unique
  owner   User?   @relation("SalonOwner", fields: [ownerId], references: [id], onDelete: Cascade)


  // Relations
  coiffeurs       Coiffeur[]
  services        Service[]
  appointments    Appointment[]
  reviews         Review[]
  openingHours    OpeningHour[]
  gallery         GalleryImage[]
  paymentMethods  SalonPaymentMethod[]
  salonSettings   SalonSettings?
  planningBreaks  PlanningBreak[]
  planningExceptions PlanningException[]
  planningHolidays PlanningHoliday[]
  staffMembers    StaffMember[]
  promoCodes      PromoCode[]
  loyalties       Loyalty[]

  @@map("salons")
}

// ============================================
// COIFFEUR MODEL
// ============================================
model Coiffeur {
  id          String   @id @default(uuid())
  bio         String?
  specialties String?  // JSON string of specialties (SQLite doesn't support arrays)
  rating      Float    @default(0)
  reviewCount Int      @default(0)
  isAvailable Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // User relation
  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Salon relation
  salonId String
  salon   Salon  @relation(fields: [salonId], references: [id], onDelete: Cascade)

  // Relations
  appointments Appointment[]
  services     Service[] @relation("CoiffeurServices")
  availability Availability[]

  @@map("coiffeurs")
}

// ============================================
// SERVICE MODEL
// ============================================
model Service {
  id          String   @id @default(uuid())
  name        String
  description String?
  price       Float
  duration    Int      // Duration in minutes
  category    String   // coupe, coloration, soin, etc.
  depositPercentage Int? // Pourcentage d'acompte
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  imageUrl    String?  // URL persistante de l'image du service

  // Salon relation
  salonId String
  salon   Salon  @relation(fields: [salonId], references: [id], onDelete: Cascade)

  // Coiffeurs who can perform this service
  coiffeurs Coiffeur[] @relation("CoiffeurServices")

  // Relations
  appointments Appointment[]
  images       ServiceImage[]

  @@map("services")
}

// ============================================
// FEEDBACK MODEL
// ============================================
model Feedback {
  id        String   @id @default(uuid())
  type      String   // bug, suggestion, problem
  payload   String   // JSON string (SQLite compatibility)
  contact   String?
  status    String   @default("NEW") // NEW, READ, RESOLVED
  createdAt DateTime @default(now())

  userId String?
  user   User?   @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@map("feedback")
}

// ============================================
// SERVICE IMAGE MODEL
// ============================================
model ServiceImage {
  id        String   @id @default(uuid())
  url       String
  createdAt DateTime @default(now())

  // Service relation
  serviceId String
  service   Service @relation(fields: [serviceId], references: [id], onDelete: Cascade)

  @@map("service_images")
}

// ============================================
// APPOINTMENT MODEL
// ============================================
model Appointment {
  id        String            @id @default(uuid())
  date      DateTime
  startTime String            // Format: "HH:mm"
  endTime   String            // Format: "HH:mm"
  status    String            @default("PENDING") // PENDING, PENDING_ASSIGNMENT, CONFIRMED, IN_PROGRESS, COMPLETED, CANCELLED, NO_SHOW
  notes     String?
  totalPrice Float
  createdAt DateTime          @default(now())
  updatedAt DateTime          @updatedAt

  // Client relation
  clientId String
  client   User   @relation("ClientAppointments", fields: [clientId], references: [id])

  // Salon relation
  salonId String
  salon   Salon  @relation(fields: [salonId], references: [id], onDelete: Cascade)

  // Coiffeur relation (nullable - assigned by salon owner)
  coiffeurId String?
  coiffeur   Coiffeur? @relation(fields: [coiffeurId], references: [id])

  // Service relation
  serviceId String
  service   Service @relation(fields: [serviceId], references: [id])

  // Payment relation
  payment Payment?
  messages ChatMessage[]

  @@map("appointments")
}

// ============================================
// CHAT MESSAGE MODEL
// ============================================
model ChatMessage {
  id            String      @id @default(uuid())
  text          String?
  audioUrl      String?
  createdAt     DateTime    @default(now())

  appointmentId String
  appointment   Appointment @relation(fields: [appointmentId], references: [id], onDelete: Cascade)

  senderId      String
  sender        User        @relation(fields: [senderId], references: [id], onDelete: Cascade)

  @@index([appointmentId, createdAt])
  @@map("chat_messages")
}

// AppointmentStatus values: PENDING, PENDING_ASSIGNMENT, CONFIRMED, IN_PROGRESS, COMPLETED, CANCELLED, NO_SHOW

// ============================================
// PAYMENT MODEL
// ============================================
model Payment {
  id            String    @id @default(uuid())
  transactionId String?   // External payment provider ID (Wave, Orange Money, etc.)
  amount        Float     // Montant de base
  fees          Float     @default(0) // Frais de transaction
  totalAmount   Float     // Montant total (amount + fees)
  currency      String    @default("XOF") // Franc CFA
  status        String    @default("PENDING") // PENDING, PENDING_CASH, COMPLETED, FAILED, REFUNDED
  method        String?   // WAVE, ORANGE_MONEY, FREE_MONEY, CARD, CASH
  reference     String?   @unique // Référence interne unique
  phoneNumber   String?   // Numéro de téléphone pour paiements mobiles
  completedAt   DateTime? // Date de confirmation du paiement
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Appointment relation (optional)
  appointmentId String?     @unique
  appointment   Appointment? @relation(fields: [appointmentId], references: [id], onDelete: Cascade)

  // User relation
  userId String
  user   User   @relation(fields: [userId], references: [id])

  @@map("payments")
}

// PaymentStatus values: PENDING, COMPLETED, FAILED, REFUNDED

// ============================================
// REVIEW MODEL
// ============================================
model Review {
  id        String   @id @default(uuid())
  rating    Int      // 1-5
  comment   String?
  status    String   @default("approved") // approved, pending, rejected
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // User relation
  userId String
  user   User   @relation(fields: [userId], references: [id])

  // Salon relation
  salonId String
  salon   Salon  @relation(fields: [salonId], references: [id], onDelete: Cascade)

  @@unique([userId, salonId]) // One review per user per salon
  @@map("reviews")
}

// ============================================
// OPENING HOURS MODEL
// ============================================
model OpeningHour {
  id        String  @id @default(uuid())
  dayOfWeek Int     // 0 = Sunday, 1 = Monday, etc.
  openTime  String  // Format: "HH:mm"
  closeTime String  // Format: "HH:mm"
  isClosed  Boolean @default(false)

  // Salon relation
  salonId String
  salon   Salon  @relation(fields: [salonId], references: [id], onDelete: Cascade)

  @@unique([salonId, dayOfWeek])
  @@map("opening_hours")
}

// ============================================
// AVAILABILITY MODEL
// ============================================
model Availability {
  id        String   @id @default(uuid())
  date      DateTime
  startTime String   // Format: "HH:mm"
  endTime   String   // Format: "HH:mm"
  isBooked  Boolean  @default(false)

  // Coiffeur relation
  coiffeurId String
  coiffeur   Coiffeur @relation(fields: [coiffeurId], references: [id], onDelete: Cascade)

  @@map("availabilities")
}


// ============================================
// LOYALTY MODEL
// ============================================
model Loyalty {
  id        String   @id @default(uuid())
  points    Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Client relation
  clientId String
  client   User   @relation(fields: [clientId], references: [id])
  salonId  String?
  salon    Salon? @relation(fields: [salonId], references: [id], onDelete: Cascade)

  @@unique([clientId, salonId])
  @@map("loyalty")
}

// ============================================
// GALLERY IMAGE MODEL
// ============================================
model GalleryImage {
  id        String   @id @default(uuid())
  url       String
  caption   String?
  category  String?  // coupe, coloration, etc.
  createdAt DateTime @default(now())

  // Salon relation
  salonId String
  salon   Salon  @relation(fields: [salonId], references: [id], onDelete: Cascade)

  @@map("gallery_images")
}
